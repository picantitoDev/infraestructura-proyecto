---
- name: Instalar NFS client y utilidades base
  ansible.builtin.apt:
    name:
      - nfs-common
      - ca-certificates
      - curl
    state: present
    update_cache: yes

- name: Crear directorios de montura
  ansible.builtin.file:
    path: "{{ item.path }}"
    state: directory
    mode: "0755"
  loop: "{{ nfs_mounts | default([]) }}"
  when: nfs_mounts | length > 0

- name: Montar exportaciones NFS (y persistir en /etc/fstab)
  ansible.posix.mount:
    src: "{{ item.src }}"
    path: "{{ item.path }}"
    fstype: nfs
    opts: "{{ item.opts | default('defaults') }}"
    state: mounted
  loop: "{{ nfs_mounts | default([]) }}"
  when: nfs_mounts | length > 0
